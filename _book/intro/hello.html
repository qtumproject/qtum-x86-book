
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Hello World Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="features.html" />
    
    
    <link rel="prev" href="toolchain.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="whatis.html">
            
                <a href="whatis.html">
            
                    
                    What is Qtum-x86
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="toolchain.html">
            
                <a href="toolchain.html">
            
                    
                    Toolchain setup
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="hello.html">
            
                <a href="hello.html">
            
                    
                    Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="features.html">
            
                <a href="features.html">
            
                    
                    New Features in Qtum-x86
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <span>
            
                    
                    UTXO Interaction
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" >
            
                <span>
            
                    
                    Contract Events
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" >
            
                <span>
            
                    
                    Censorship Resistant State Proofs (not yet implemented)
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" >
            
                <span>
            
                    
                    Trusted Library Contracts (not yet implemented)
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" >
            
                <span>
            
                    
                    Contract Upgrades
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" >
            
                <span>
            
                    
                    Universal Address System
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" >
            
                <span>
            
                    
                    External Contract State Access
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" >
            
                <span>
            
                    
                    Shared Contract Communication Stack (SCCS)
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Mock-libqtum for Contract Testing (not yet implemented)
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Comparison to Solidity
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">Programming Walkthroughs</li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <span>
            
                    
                    Simple Payment Forwarding Contract
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <span>
            
                    
                    Voting Contract
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" >
            
                <span>
            
                    
                    Simple ERC20 (XRC20) Token Contract
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" >
            
                <span>
            
                    
                    Adding Crowdsale Features to the XRC20 Contract
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" >
            
                <span>
            
                    
                    Transaction Witness
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" >
            
                <span>
            
                    
                    Porting and Using Open Source C Libraries
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" >
            
                <span>
            
                    
                    Using C++ in Contracts (not yet implemented)
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" >
            
                <span>
            
                    
                    An Upgradeable Contract
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" >
            
                <span>
            
                    
                    Adapting a Solidity Contract to Qtum-x86
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">Programming Reference</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                    ABI format reference (not yet complete)
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../prog-ref/variables.html">
            
                <a href="../prog-ref/variables.html">
            
                    
                    Libqtum Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../prog-ref/structs.md">
            
                <span>
            
                    
                    Libqtum Structures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../prog-ref/functions.html">
            
                <a href="../prog-ref/functions.html">
            
                    
                    Libqtum General Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../prog-ref/states.html">
            
                <a href="../prog-ref/states.html">
            
                    
                    Libqtum State and Event Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../prog-ref/rpc.md">
            
                <span>
            
                    
                    Qtum-x86 RPC Call Reference
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Toolchain Reference</li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <span>
            
                    
                    Tools Available
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" >
            
                <span>
            
                    
                    Standard C Library
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" >
            
                <span>
            
                    
                    Memory Allocation
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" >
            
                <span>
            
                    
                    Compiling Toolchain from Source
            
                </span>
            

            
        </li>
    

    
        
        <li class="header">Toolchain Porting Reference</li>
        
        
    
        <li class="chapter " data-level="5.1" >
            
                <span>
            
                    
                    Introduction to Porting to Qtum-x86
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" >
            
                <span>
            
                    
                    CPU Instructions
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" >
            
                <span>
            
                    
                    Memory Map
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" >
            
                <span>
            
                    
                    Qtum Structures
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" >
            
                <span>
            
                    
                    System Call Interface and Reference
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" >
            
                <span>
            
                    
                    Restrictions and Guidelines
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="5.7" >
            
                <span>
            
                    
                    Blockchain Binary Format and ELF Conversion
            
                </span>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Hello World</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="hello-world">Hello World</h1>
<p>After the toolchain is setup, we can finally test it by creating a simple Hello World smart contract.</p>
<p>This is the source code for a very simple Hello World contract:</p>
<pre><code>#include &lt;qtum.h&gt;

int onCreate(){
    qtumEventStringString(&quot;Hello World&quot;, &quot;Contract creation&quot;);
    return 0;
}

int main(){
    qtumEventStringString(&quot;Hello World&quot;, &quot;Execution Success!&quot;);
    return 0;
}
</code></pre><p>The <code>onCreate</code> function is called only when the contract is initially deployed to the blockchain using <code>createcontract</code> or <code>qx86deploy</code>. The <code>main</code> function is called anytime the contract is called, either by another smart contract, or by <code>callcontract</code> or <code>sendtocontract</code>. </p>
<p>The <code>qtumEventStringString</code> function creates a new event upon execution. The <code>StringString</code> suffix means that the &quot;key&quot; of the event is a string and that the &quot;value&quot; is a string. There are also functions like <code>qtumEventStringInt64</code> for specifying a 64bit integer key rather than a string. Using this we can later retreive the event using <code>qx86cli searchevents</code>. </p>
<p>The compilation process for this smart contract is a bit more complicated. We use the toolchain docker container in order to do the actual processing. This makes it simple to compile Qtum-x86 smart contracts on any operating system, rather than just Linux or OSX. </p>
<p>First, we write a makefile. This makefile will be executed on the docker container so that all of the Qtum tooling is available. Here is the template we use for hello world:</p>
<pre><code># files to be built
# fill this in as a template
HDRS = 
C_SRC = helloworld.c
OUTPUT = helloworld.elf
LIBS = 
BYTECODE = helloworld.qbit

C_OBJS = $(subst .c,.o,$(C_SRC))

#these default flags will just remove dead code and give warnings
CFLAGS += -Wall -ffunction-sections -fdata-sections
LDFLAGS += -Wl,--gc-section


default: $(BYTECODE)

$(BYTECODE): $(OUTPUT)
    x86testbench -assemble -raw $(OUTPUT) &gt; $(BYTECODE)

$(OUTPUT): $(C_OBJS)
    $(CC) $(LDFLAGS) -o $(OUTPUT) $(C_OBJS) $(LIBS)

$(C_OBJS): $(HDRS) $(C_SRC)
    $(CC) $(CFLAGS) -c $*.c -o $@

clean:
    rm -f $(C_OBJS) $(OUTPUT) $(BYTECODE)
</code></pre><p>Lets break the variables of this down:</p>
<pre><code>HDRS = 
</code></pre><p>This is to track any header files in the contract. Although header files are not compiled directly, these are tracked so that the code can be recompiled when any header file is changed.</p>
<pre><code>C_SRC = helloworld.c
</code></pre><p>These are the C files to be compiled. This can be expanded to multiple files by appending additional file names with a space separator. </p>
<pre><code>OUTPUT = helloworld.elf
</code></pre><p>This is the output of the GCC compiler. This is a standard ELF file and is ideal for post-compilation analysis. Most existing reverse engineering and analysis tools support this format. Thus, if analysis is needed on the binary file from the compiler, this is the one to use. </p>
<pre><code>LIBS = 
</code></pre><p>This is for adding static libraries to the contract.</p>
<pre><code>BYTECODE = helloworld.qbit
</code></pre><p>This is the actual bytecode file that is formatted for the Qtum blockchain. This is greatly simplified from ELF and although is a very easy to parse and use due to its limitations, no tools will support this (at least yet). When deploying this to the blockchain using <code>qx86deploy</code>, the Qtum RPC command &quot;createcontract&quot; is used, and the argument is this file which is dumped to a hex string. </p>
<p>These are the important things to know about modifying this Makefile. For most simple contracts, this will be sufficient. With more complicated ones involving many libraries etc, it may be ideal to to write a custom makefile using this for inspiration. </p>
<p>In order to actually deploy this contract, you can use this script in a local shell (assuming you sourced the &quot;helpers.sh&quot; script from the toolchain setup)</p>
<pre><code>qx86start
qx86cli generate 600 # this will generate 600 blocks. This will start the chain and give us some coins to work with
qx86deploy helloworld.qbit
qx86cli generate 1 # generate 1 block so that we can mine our contract and ensure its processed
</code></pre><p>After this, you should see output like this:</p>
<pre><code>Jordans-MacBook-Pro:helloworld earlz$ qx86deploy helloworld.qbit
{
  &quot;txid&quot;: &quot;02b28cfcc7d1fdcb5963ee2ff9024a045ac6fb4d8d66683b027e47fd5973ed0b&quot;,
  &quot;sender&quot;: &quot;qUJfCTe5LacTUBjC7djrEfoMtfZGXD7J4L&quot;,
  &quot;hash160&quot;: &quot;75e089080145b639bf496e27cc3ed655e13377d0&quot;,
  &quot;hexaddress&quot;: &quot;85840fafe5b51343f58259de8b48fe6b001cce57&quot;,
  &quot;address&quot;: &quot;xLUbyAmNUTRxLt67x5gDtDxBzWpLrH92Zn&quot;
}
Jordans-MacBook-Pro:helloworld earlz$ qx86cli generate 1
[
  &quot;300b9d8d9e5d05c22d09ff91335766e559af21ab70ee6f37daf280220eecc06d&quot;
]
</code></pre><p>There are a lot of different fields returned from the deployment command. The important one is <code>address</code> with a value of <code>xLUbyAmNUTRxLt67x5gDtDxBzWpLrH92Zn</code>. This will vary on different instances of the blockchain, so this will effectively be random. The <code>txid</code> field is the transaction ID which the contract was placed in. </p>
<p>Now you can do the following:</p>
<pre><code>qx86cli searchevents
</code></pre><p>This will give a fairly large JSON output. There will be one for each contract execution, no matter if the contract failed or not. Here is a breakdown of the fields in the JSON:</p>
<ul>
<li>block-hash -- the block hash in which the execution occured. </li>
<li>tx-hash -- TBD</li>
<li>tx-n -- TBD</li>
<li>address -- the root contract address which was executed. This is either the address created by <code>createcontract</code> or called by <code>sendtocontract</code></li>
<li>used-gas -- how much gas was used by the execution</li>
<li>sender-refund -- how many coins will be returned to the sender. In case of an error or revert, all coins sent in an execution will be refunded</li>
<li>status -- the description string of the execution status</li>
<li>status-code -- a numeric code for the execution status</li>
<li>transfer-txid -- TBD</li>
<li>commit-state -- Whether or not state is committed for this contract execution</li>
<li>deltas -- All state changes which occur in this contract execution. This is attempted to be automatically parsed for strings or numbers and displayed in a more user friendly manner (note: might change later)</li>
<li>deltas-raw -- the same as deltas, but is always displayed in raw hex form</li>
<li>modified-balances -- all address balances which are modified by this execution</li>
<li>spent-vins -- all of the UTXOs which will be marked as spent due to this execution</li>
<li>events -- the actual events created by this execution. This is an array of key-value pairs</li>
<li>calls -- this is a recursive structure where other execution results (this json structure) are placed within it. There is one result for each contract call which takes place within the overall execution. It is possible for results to be nested multiple levels (note: this is subject to change)</li>
</ul>
<p>You&apos;ll see something like this at the bottom of the JSON output:</p>
<pre><code>      &quot;modified-balances&quot;: {
      },
      &quot;spent-vins&quot;: [
      ]
    },
    &quot;events&quot;: {
      &quot;Hello World&quot;: &quot;Contract creation&quot;
    },
    &quot;calls&quot;: [
    ]
  }
]
</code></pre><p>The hello world event for contract creation is seen here. </p>
<p>In order to call the contract to test it (replacing the address with yours), do the following:</p>
<pre><code>qx86cli callcontract xLUbyAmNUTRxLt67x5gDtDxBzWpLrH92Zn 00
</code></pre><p>This will immediately return a JSON result. <code>callcontract</code> simply calls the contract locally and does NOT create a blockchain transaction. Thus, there are no fees etc associated with <code>callcontract</code>. In the JSON result you should now see <code>&quot;Hello World&quot;: &quot;Execution Success!&quot;</code> in the events array. </p>
<p>In order to do the same thing but on the blockchain as an actual transaction, do the following:</p>
<pre><code>qx86cli sendtocontract xLUbyAmNUTRxLt67x5gDtDxBzWpLrH92Zn 00
qx86cli generate 1 #create one block to confirm the transaction
</code></pre><p>You will not see the large JSON result. In order to see it, you need to use <code>searchevents</code> again. </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="toolchain.html" class="navigation navigation-prev " aria-label="Previous page: Toolchain setup">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="features.html" class="navigation navigation-next " aria-label="Next page: New Features in Qtum-x86">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Hello World","level":"1.4","depth":1,"next":{"title":"New Features in Qtum-x86","level":"1.5","depth":1,"path":"intro/features.md","ref":"intro/features.md","articles":[{"title":"UTXO Interaction","level":"1.5.1","depth":2,"ref":"","articles":[]},{"title":"Contract Events","level":"1.5.2","depth":2,"ref":"","articles":[]},{"title":"Censorship Resistant State Proofs (not yet implemented)","level":"1.5.3","depth":2,"ref":"","articles":[]},{"title":"Trusted Library Contracts (not yet implemented)","level":"1.5.4","depth":2,"ref":"","articles":[]},{"title":"Contract Upgrades","level":"1.5.5","depth":2,"ref":"","articles":[]},{"title":"Universal Address System","level":"1.5.6","depth":2,"ref":"","articles":[]},{"title":"External Contract State Access","level":"1.5.7","depth":2,"ref":"","articles":[]},{"title":"Shared Contract Communication Stack (SCCS)","level":"1.5.8","depth":2,"ref":"","articles":[]}]},"previous":{"title":"Toolchain setup","level":"1.3","depth":1,"path":"intro/toolchain.md","ref":"intro/toolchain.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"intro/hello.md","mtime":"2019-01-11T22:53:15.363Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-02-08T00:49:00.670Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

